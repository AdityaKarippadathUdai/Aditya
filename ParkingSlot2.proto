#VRML_SIM R2025a utf8
PROTO ParkingSlot2 [
  field SFVec3f    translation      0 0 0        # Position of the sensor robot
  field SFRotation rotation         0 0 1 0      # Rotation of the sensor robot
  field SFString   name             "sensor_robot_2" # Unique name for the robot
  field SFVec3f    sensorTranslation 0.05 0 0.25  # Translation for sensor (adjusted for cube center at 0.25 m)
]
{
  Robot {
    translation IS translation
    rotation IS rotation
    name IS name
    controller "parking_controller_multiple"    # Controller for this robot

    children [
      # Vertical Sensor Mount (Cube structure)
      Transform {
        translation 0 0 0.25  # Center of the cube at 0.25 m height (half of 0.5 m)
        children [
          Shape {
            appearance Appearance {
              material Material {
                diffuseColor 0.7 0.7 0.7  # Light gray for the mount
              }
            }
            geometry Box {
              size 0.5 0.5 0.5  # Cube with equal sides (0.5m x 0.5m x 0.5m)
            }
          }
        ]
      }

      # Sensor Placement on the Mount
      Transform {
        translation IS sensorTranslation  # Bind the full translation vector (0.05 0 0.25)
        rotation 0 1 0 1.57              # Rotate 90 degrees around y-axis to point along positive x-axis
        children [
          DistanceSensor {
            name "parking_sensor"
            lookupTable [
              0.0 0.0 0.0,    # Min range (0m)
              5.0 5.0 0.0     # Max range (5m)
            ]
            resolution 0.01
            # Note: fieldOfView is not supported; default FOV is ~5.7 degrees
          }

          # Visual Indicator for Sensor (Two Circles)
          Transform {
            translation 0 0.1 0  # Offset along y-axis (local y after rotation becomes z in world)
            children [
              Shape {
                appearance Appearance {
                  material Material {
                    diffuseColor 1 0 0  # Red color for visibility
                  }
                }
                geometry Sphere { radius 0.05 }  # First circle
              }
            ]
          }
          
          Transform {
            translation 0 -0.1 0  # Offset along y-axis (local y after rotation becomes z in world)
            children [
              Shape {
                appearance Appearance {
                  material Material {
                    diffuseColor 1 0 0  # Red color for visibility
                  }
                }
                geometry Sphere { radius 0.05 }  # Second circle
              }
            ]
          }
        ]
      }

      # Arrow to Show Sensor Direction
      Transform {
        translation 0.15 0 0.25  # Adjusted to align with sensor at cube center (z = 0.25 m)
        rotation 0 1 0 1.57     # Align with sensor direction (pointing along positive x-axis)
        children [
          Shape {
            appearance Appearance {
              material Material {
                diffuseColor 1 0 0  # Red color
              }
            }
            geometry Cone {
              bottomRadius 0.05
              height 0.1
            }
          }
        ]
      }

      # Display for Interface
      Display {
        width 200
        height 100
        name "sensor_display"
        translation 0 0 0.5  # Adjusted above the cube (top at 0.5 m)
      }
    ]

    # Bounding Object for the Robot (Matches the cube)
    boundingObject Transform {
      translation 0 0 0.25
      children [
        Box { 
          size 1.5 0.5 0.5  # Matches the cube dimensions
        }
      ]
    }
  }
}